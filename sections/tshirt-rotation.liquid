{% comment %}
  T-Shirt 3D Rotation Section
  - 360Â° rotation on scroll
  - Artist names animation
  - Gradient background
  - Final CTA state
{% endcomment %}

{{ 'section-tshirt-rotation.css' | asset_url | stylesheet_tag }}

{%- comment -%} Desktop Version - Scroll Scrub Animation {%- endcomment -%}
<div class="tshirt-rotation__wrapper tshirt-rotation__wrapper--desktop">
  <div class="tshirt-rotation" data-section-id="{{ section.id }}">
  {%- comment -%} Pinned Content Container {%- endcomment -%}
  <div class="tshirt-rotation__pinned" data-pinned-container>
    {%- comment -%} Gradient Background (Inside Pinned) {%- endcomment -%}
    <div class="tshirt-rotation__gradient-container">
      <div class="tshirt-rotation__gradient-layer">&nbsp;</div>
      <div class="tshirt-rotation__gradient-layer">&nbsp;</div>
      <div class="tshirt-rotation__gradient-layer">&nbsp;</div>
    </div>

    {%- comment -%} Canvas for T-Shirt Sequence {%- endcomment -%}
    <canvas
      class="tshirt-rotation__canvas"
      data-canvas
      width="1200"
      height="1200"
      aria-label="Rotating 3D t-shirt animation"
    ></canvas>

    {%- comment -%} Artist Names (Animated) {%- endcomment -%}
    <div class="tshirt-rotation__artist-names" data-artist-names>
      {%- if section.settings.artist_1 != blank -%}
        <div class="tshirt-rotation__artist-name tshirt-rotation__artist-name--back" data-artist="1">{{ section.settings.artist_1 }}</div>
      {%- endif -%}
      {%- if section.settings.artist_2 != blank -%}
        <div class="tshirt-rotation__artist-name tshirt-rotation__artist-name--front" data-artist="2">{{ section.settings.artist_2 }}</div>
      {%- endif -%}
      {%- if section.settings.artist_3 != blank -%}
        <div class="tshirt-rotation__artist-name tshirt-rotation__artist-name--back" data-artist="3">{{ section.settings.artist_3 }}</div>
      {%- endif -%}
    </div>

    {%- comment -%} Final CTA Section {%- endcomment -%}
    <div class="tshirt-rotation__cta" data-cta>
      {%- if section.settings.cta_heading != blank -%}
        <h2 class="tshirt-rotation__cta-heading">{{ section.settings.cta_heading }}</h2>
      {%- endif -%}
      {%- if section.settings.cta_paragraph != blank -%}
        <p class="tshirt-rotation__cta-paragraph">
          {{ section.settings.cta_paragraph }}
        </p>
      {%- endif -%}
      {%- if section.settings.cta_button_text != blank -%}
        <button
          class="tshirt-rotation__button"
          onclick="window.location.href='{{ section.settings.cta_button_link }}'"
          data-cta-button
        >
          <span class="tshirt-rotation__button-fill"></span>
          <span class="tshirt-rotation__button-text">{{ section.settings.cta_button_text }}</span>
        </button>
      {%- endif -%}
    </div>
  </div>

  {%- comment -%} Spacer for Scroll Distance (400vh) {%- endcomment -%}
  <div class="tshirt-rotation__spacer" data-spacer></div>

  {%- comment -%} Preload Image Data {%- endcomment -%}
  <script>
    window.tshirtRotationData = window.tshirtRotationData || {};
    window.tshirtRotationData['{{ section.id }}'] = {
      imageUrls: [
        {%- assign max_frame = section.settings.total_frames | minus: 1 -%}
        {%- for i in (0..max_frame) -%}
          "{{ 't_shirt-animation-3d/images/img_' | append: i | append: '.webp' | asset_url }}"{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ]
    };
  </script>
  </div>
</div>

{%- comment -%} Mobile Version - Play Once Animation {%- endcomment -%}
<div class="tshirt-rotation-mobile__wrapper">
  <div class="tshirt-rotation-mobile" data-section-id="{{ section.id }}">
    {%- comment -%} Gradient Background {%- endcomment -%}
    <div class="tshirt-rotation-mobile__gradient-container">
      <div class="tshirt-rotation-mobile__gradient-layer">&nbsp;</div>
      <div class="tshirt-rotation-mobile__gradient-layer">&nbsp;</div>
      <div class="tshirt-rotation-mobile__gradient-layer">&nbsp;</div>
    </div>

    {%- comment -%} Canvas for T-Shirt (Last Frame Only) {%- endcomment -%}
    <canvas
      class="tshirt-rotation-mobile__canvas"
      data-canvas-mobile
      width="1200"
      height="1200"
      aria-label="3D t-shirt"
    ></canvas>

    {%- comment -%} CTA Content {%- endcomment -%}
    <div class="tshirt-rotation-mobile__cta" data-cta-mobile>
      {%- if section.settings.cta_heading != blank -%}
        <h2 class="tshirt-rotation-mobile__cta-heading">{{ section.settings.cta_heading }}</h2>
      {%- endif -%}
      {%- if section.settings.cta_paragraph != blank -%}
        <p class="tshirt-rotation-mobile__cta-paragraph">
          {{ section.settings.cta_paragraph }}
        </p>
      {%- endif -%}
      {%- if section.settings.cta_button_text != blank -%}
        <button
          class="tshirt-rotation-mobile__button"
          onclick="window.location.href='{{ section.settings.cta_button_link }}'"
          data-cta-button-mobile
        >
          <span class="tshirt-rotation-mobile__button-fill"></span>
          <span class="tshirt-rotation-mobile__button-text">{{ section.settings.cta_button_text }}</span>
        </button>
      {%- endif -%}
    </div>
  </div>

  {%- comment -%} Preload Last Frame for Mobile {%- endcomment -%}
  <script>
    window.tshirtRotationMobileData = window.tshirtRotationMobileData || {};
    {%- assign last_frame_index = section.settings.total_frames | minus: 1 -%}
    window.tshirtRotationMobileData['{{ section.id }}'] = {
      lastFrameUrl: "{{ 't_shirt-animation-3d/images/img_' | append: last_frame_index | append: '.webp' | asset_url }}"
    };
  </script>
</div>

<script src="{{ 'section-tshirt-rotation.js' | asset_url }}" defer></script>
<script src="{{ 'section-tshirt-rotation-mobile.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "T-Shirt Rotation",
  "class": "section-tshirt-rotation",
  "settings": [
    {
      "type": "paragraph",
      "content": "3D T-shirt rotation animation with artist names and CTA. Scroll-based animation using GSAP."
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "number",
      "id": "total_frames",
      "label": "Total Animation Frames",
      "info": "Total number of frame images (img_0.webp to img_N.webp). Example: 151 means frames 0-150, 200 means frames 0-199",
      "default": 151
    },
    {
      "type": "header",
      "content": "Artist Names"
    },
    {
      "type": "text",
      "id": "artist_1",
      "label": "Artist 1",
      "default": "HARDWELL"
    },
    {
      "type": "text",
      "id": "artist_2",
      "label": "Artist 2",
      "default": "MARTIN GARRIX"
    },
    {
      "type": "text",
      "id": "artist_3",
      "label": "Artist 3",
      "default": "AFROJACK"
    },
    {
      "type": "header",
      "content": "CTA Content"
    },
    {
      "type": "text",
      "id": "cta_heading",
      "label": "CTA Heading",
      "default": "WEAR TO RAVE"
    },
    {
      "type": "textarea",
      "id": "cta_paragraph",
      "label": "CTA Paragraph",
      "default": "Born from the energy of the dancefloor, designed for those who live for the drop. Our collection merges streetwear aesthetics with rave culture, creating pieces that move with you from the studio to the stage."
    },
    {
      "type": "text",
      "id": "cta_button_text",
      "label": "Button Text",
      "default": "EXPLORE OUR COLLECTIONS"
    },
    {
      "type": "url",
      "id": "cta_button_link",
      "label": "Button Link",
      "default": "/collections/all"
    }
  ],
  "presets": [
    {
      "name": "T-Shirt Rotation"
    }
  ]
}
{% endschema %}
