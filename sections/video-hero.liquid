{%- comment -%}
  Video Hero Section
  Full-screen video with scroll animation and audio control
  Randomly selects from available videos on each page load
{%- endcomment -%}

{{ 'section-video-hero.css' | asset_url | stylesheet_tag }}

{%- comment -%} Collect all available video URLs into an array {%- endcomment -%}
{%- capture video_urls -%}
  {%- if section.settings.video_url_1 != blank -%}{{ section.settings.video_url_1 }}|{%- endif -%}
  {%- if section.settings.video_url_2 != blank -%}{{ section.settings.video_url_2 }}|{%- endif -%}
  {%- if section.settings.video_url_3 != blank -%}{{ section.settings.video_url_3 }}|{%- endif -%}
  {%- if section.settings.video_url_4 != blank -%}{{ section.settings.video_url_4 }}|{%- endif -%}
  {%- if section.settings.video_url_5 != blank -%}{{ section.settings.video_url_5 }}|{%- endif -%}
{%- endcapture -%}

{%- assign available_videos = video_urls | strip | split: '|' -%}
{%- assign video_count = 0 -%}
{%- for video in available_videos -%}
  {%- if video != blank -%}
    {%- assign video_count = video_count | plus: 1 -%}
  {%- endif -%}
{%- endfor -%}

{%- comment -%} Generate random index based on current timestamp {%- endcomment -%}
{%- assign selected_video = '' -%}
{%- if video_count > 0 -%}
  {%- assign random_seed = 'now' | date: '%s' | times: 17 | modulo: 1000 -%}
  {%- assign random_index = random_seed | modulo: video_count -%}
  {%- assign selected_video = available_videos[random_index] -%}
{%- endif -%}

<div 
  class="video-hero" 
  data-section-id="{{ section.id }}"
  data-video-count="{{ video_count }}"
  data-selected-video="{{ selected_video }}"
  x-data="videoHero()"
  x-init="init()"
>
  {%- comment -%} Full-screen video background {%- endcomment -%}
  <video 
    class="video-hero__video"
    autoplay
    muted
    loop
    playsinline
    preload="auto"
    x-ref="video"
    @loadeddata="console.log('Video loaded successfully')"
    @error="console.error('Video failed to load')"
  >
    {%- if selected_video != blank -%}
      <source src="{{ selected_video }}" type="video/mp4">
    {%- endif -%}
  </video>

  {%- comment -%} Bottom overlay with controls {%- endcomment -%}
  <div class="video-hero__overlay">
    <div class="video-hero__controls">
      {%- comment -%} Left: Empty spacer (100x100) {%- endcomment -%}
      <div class="video-hero__controls-left">
        &nbsp;
      </div>

      {%- comment -%} Center: Scroll indicator animation (100x100) {%- endcomment -%}
      <div class="video-hero__controls-center">
        {% render 'scroll-indicator' %}
      </div>

      {%- comment -%} Right: Audio control button (100x100) {%- endcomment -%}
      <div class="video-hero__controls-right">
        <button 
          class="audio-control" 
          @click="toggleAudio()"
          :class="{ 'is-playing': isAudioPlaying }"
          :aria-label="isAudioPlaying ? 'Mute audio' : 'Unmute audio'"
          type="button"
        >
          <div class="audio-control__bars">
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
          </div>
        </button>
        
        {%- comment -%} Audio hint tooltip {%- endcomment -%}
        <div 
          class="audio-hint"
          x-show="showAudioHint"
          x-cloak
        >
          To play audio, click here
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ 'section-video-hero.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Video Hero",
  "tag": "section",
  "class": "section-video-hero",
  "settings": [
    {
      "type": "header",
      "content": "Video Settings"
    },
    {
      "type": "paragraph",
      "content": "Add up to 5 videos. One will be randomly selected on each page load."
    },
    {
      "type": "text",
      "id": "video_url_1",
      "label": "Video URL 1",
      "info": "Enter the Shopify CDN URL for video 1"
    },
    {
      "type": "text",
      "id": "video_url_2",
      "label": "Video URL 2",
      "info": "Enter the Shopify CDN URL for video 2"
    },
    {
      "type": "text",
      "id": "video_url_3",
      "label": "Video URL 3",
      "info": "Enter the Shopify CDN URL for video 3"
    },
    {
      "type": "text",
      "id": "video_url_4",
      "label": "Video URL 4",
      "info": "Enter the Shopify CDN URL for video 4"
    },
    {
      "type": "text",
      "id": "video_url_5",
      "label": "Video URL 5",
      "info": "Enter the Shopify CDN URL for video 5"
    }
  ],
  "presets": [
    {
      "name": "Video Hero"
    }
  ]
}
{% endschema %}
