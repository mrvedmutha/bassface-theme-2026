{%- comment -%}
  Video Hero Section
  Full-screen video with Spotify iframe player
{%- endcomment -%}

{{ 'section-video-hero.css' | asset_url | stylesheet_tag }}

<div
  class="video-hero"
  data-section-id="{{ section.id }}"
  x-data="videoHero()"
  x-init="init()"
>
  {%- comment -%} Full-screen video background {%- endcomment -%}
  <video
    class="video-hero__video"
    autoplay
    muted
    loop
    playsinline
    preload="auto"
    x-ref="video"
    @loadeddata="console.log('Video loaded successfully')"
    @error="console.error('Video failed to load')"
  >
    {%- if section.settings.video_url != blank -%}
      <source src="{{ section.settings.video_url }}" type="video/mp4">
    {%- endif -%}
  </video>

  {%- comment -%} Bottom overlay with controls {%- endcomment -%}
  <div class="video-hero__overlay">
    <div class="video-hero__controls">
      {%- comment -%} Left: Empty spacer (100x100) {%- endcomment -%}
      <div class="video-hero__controls-left">
        &nbsp;
      </div>

      {%- comment -%} Center: Scroll indicator animation (100x100) {%- endcomment -%}
      <div class="video-hero__controls-center">
        {% render 'scroll-indicator' %}
      </div>

      {%- comment -%} Right: Audio/Music control button (100x100) {%- endcomment -%}
      <div class="video-hero__controls-right">
        <button
          class="audio-control"
          @click="togglePlayer()"
          :class="{ 'is-playing': isPlayerPlaying, 'is-open': isPlayerOpen }"
          :aria-label="isPlayerOpen ? 'Close music player' : 'Open music player'"
          type="button"
          x-ref="audioButton"
        >
          {%- comment -%} Waveform bars - shown when closed {%- endcomment -%}
          <div class="audio-control__bars">
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
            <span class="audio-control__bar">&nbsp;</span>
          </div>

          {%- comment -%} Chevron icon - shown when open {%- endcomment -%}
          <div class="audio-control__chevron">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10">
              <polygon fill="#fff" points="9.09 7.99 5.06 3.83 .91 7.99 0 7.08 5.06 2.01 10 7.08 9.09 7.99"/>
            </svg>
          </div>
        </button>

        {%- comment -%} Audio hint tooltip {%- endcomment -%}
        <div
          class="audio-hint"
          x-show="showAudioHint"
          x-cloak
        >
          Want to have some fun? Click here to play music
        </div>
      </div>
    </div>
  </div>

  {%- comment -%} Spotify Player Container - Simple show/hide with Alpine.js {%- endcomment -%}
  {%- if section.settings.spotify_iframe_code != blank -%}
    <div
      class="spotify-player-container"
      x-show="isPlayerOpen"
      x-cloak
    >
      <div class="spotify-player-wrapper">
        {{ section.settings.spotify_iframe_code }}
      </div>
    </div>
  {%- endif -%}
</div>

<script src="{{ 'section-video-hero.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Video Hero",
  "tag": "section",
  "class": "section-video-hero",
  "settings": [
    {
      "type": "header",
      "content": "Video Settings"
    },
    {
      "type": "text",
      "id": "video_url",
      "label": "Video URL",
      "info": "Enter the Shopify CDN URL for the background video"
    },
    {
      "type": "header",
      "content": "Spotify Player Settings"
    },
    {
      "type": "paragraph",
      "content": "Add a Spotify playlist iframe embed code. Get it from Spotify: Share > Embed playlist > Copy entire iframe code"
    },
    {
      "type": "html",
      "id": "spotify_iframe_code",
      "label": "Spotify Embed Code",
      "info": "Paste the entire iframe code from Spotify (e.g., <iframe src=\"https://open.spotify.com/embed/playlist/...\"></iframe>)"
    }
  ],
  "presets": [
    {
      "name": "Video Hero"
    }
  ]
}
{% endschema %}
